<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Bus Schedule</title>

	<link rel="stylesheet" href="bootstrap-4.0.0-dist/css/bootstrap.min.css">
<style>

@keyframes greenToRed {
    0%   {background-color: green;}
    45%  {background-color: green;}
    50%  {background-color: yellow;}
    52%  {background-color: gold;}
    70%  {background-color: gold;}
    75% {background-color: red;}
    77% {background-color: darkred;}
    93% {background-color: darkred;}
    95% {background-color: dodgerblue;}
    100% {background-color: blue;}
}

div#id00C button.btn.btn-primary,
#busNumberMapButton {
	animation-name: greenToRed;
	animation-duration: 60s;
	/* -webkit-animation-name: greenToRed; */
	/* -webkit-animation-duration: 60s;    */
}

/* gaps between buttons in the Pick Route panel */
#routeButtonGroup button.btn.btn-primary.col-md-1,
#routeDirectionButtonGroup button.btn.btn-primary,
#routeDirectionStopButtonGroup button.btn.btn-primary {
	margin-right: 5px; 
	margin-bottom: 7px;
}

/* gaps between collapse panel/buttons */
/* panel becomes card, panel-group has no replacement */
.card {
	margin-bottom: 0;
}
</style>

</head>
<body>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
	<span class="navbar-brand" id="title1">Bus Schedule</span>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarCollapse">
		<ul class="navbar-nav mr-auto">
			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" role="button"
					id="utilDropdown">
					Utils<span class="caret"></span>
				</a>
				<div class="dropdown-menu" >
					<a class="dropdown-item bg-success" id="utilClearTracking" onclick="clearTracking()">Reset Map</a>
					<a class="dropdown-item dropdown-divider bg-light"></a>
					<!--
					<a class="dropdown-item" id="utilGetGps"       onclick="getGps()">Show my location</a>
					-->
					<a class="dropdown-item" id="utilVisitRoutes"  onclick="visitAllRoutes()">Visit all routes</a>
					<a class="dropdown-item" id="utilWriteStops"   onclick="showDatabase()">Write stops to console</a>
					<a class="dropdown-item dropdown-divider bg-light"></a>
					
					<a class="dropdown-item bg-warning" id="utilDebugging"   onclick="toggleDebug();">Toggle debug</a>
					<a class="dropdown-item"            id="utilGetDbSize"   onclick="showDbSize();">Local storage size</a>
					<a class="dropdown-item bg-danger"  id="utilResetDataase" onclick="resetDatabase()">Delete all local data</a>
					<a class="dropdown-item"            id="utilRemoveDbUndefined"   onclick="removeDbUndefined();">Delete undefined data</a>
				</div>

			</li>
		</ul>
	</div>
</nav>
<div id="accordionMap" role="tablist" >
	<div class="card">
		<div class="card-header" role="tab">
				<div data-toggle="collapse" data-target="#collapseChoices">
					Previous Choices
				</div>
		</div>
		<div id="collapseChoices" class="collapse">
	<!--	<span id="recentChoice0" class="active hidden btn-group col-md-3 col-sm-4 col-xs-6" >&nbsp;</span> -->
			<span id="recentChoice0" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice1" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice2" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice3" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice4" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice5" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice6" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice7" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice8" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
			<span id="recentChoice9" class="active hidden btn-group" style="margin-right:4px; margin-bottom:4px;" >&nbsp;</span>
		</div>
	</div>
	<div class="card">
		<div class="card-header" data-toggle="collapse" data-target="#collapseDetails">Details</div>
		<div id="collapseDetails" class="collapse">
			<div id="detailsPanel" class="card-body" style="padding-top:0;">
				<div class="progress" style="height:2px; padding:0; margin-bottom:0; margin-top:0;">
					<div id="detailsProgress" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;">
						<!-- <span class="sr-only">70% Complete</span> -->
					</div>
				</div>
				<div id="id00C"></div>
				<div id="id00B"></div>
			</div>
		</div>
	</div>
	<div class="card">
		<div class="card-header" data-toggle="collapse" data-target="#collapseRoute">Pick Route</div>
		
		<div id="collapseRoute" class="collapse">
			<div id="routePanel" class="card-body">
				<span id="selectRouteButton" class="active btn btn-secondary" onclick="selectRoute()">Route</span>
				<span id="selectedRoute"></span>
				<span id="selectDirectionButton"    class="btn btn-secondary" onclick="selectRouteDirectionsUsingMyRoute()">Direction</span>
				<span id="selectedDirection"></span>
				<span id="selectStopButton"         class="btn btn-secondary" onclick="selectRouteDirectionStopsUsingMyDirection()">Stop</span>
				<span id="selectedStop"></span>
			</div>
			<div id="id00RouteDirectionStop"></div>
		</div>
	</div>

	<div class="card">
		<div class="card-header" data-toggle="collapse" data-target="#collapseBusStop">Bus Stop</div>
		<div id="collapseBusStop" class="collapse">
			<div class="card-body">
				<form id="busStopForm" class="form-inline" action="">
					<div class="form-group">
						<label class="sr-only" for="stopNumber">Stop Number:</label>
						<input class="form-control input-sm" id="stopNumber" type="number" min="34" max="70101" name="stopNumber" placeholder="Stop #" required />
					</div>
					<div class="form-group">
						<label class="sr-only" for="stopDescription">Description:</label>
						<input class="form-control input-sm" id="stopDescription" type="text" name="stopDescription" placeholder="Enter Description"/>
					</div>
					<button type="submit">Submit</button>
				</form>
			</div>
		</div>
	</div>

	<div class="card">
		<div class="card-header" data-toggle="collapse" data-target="#collapseMap">Map</div>
		<div id="collapseMap" class="collapse">
			<div id="map_button" class="panel-body-sm map-title"></div>
			<div class="progress" style="height:2px; padding:0; margin-bottom:0;">
				<div id="mapProgress" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;">
					<!-- <span class="sr-only">70% Complete</span> -->
				</div>
			</div>
			<div id="map_canvas" class="panel-body" style="width: 100%; height: 500px"></div>
		</div>
	</div>
	
</div>
<script src='modernizr/modernizr.js'></script>
<script src='jquery/jquery-3.3.1.min.js'></script>
<script src='BusSchedule.js'></script>

<script src="bootstrap-4.0.0-dist/js/bootstrap.bundle.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsZ0T2Q9DZ5naamWI5WEyYEqWcbxPgCs0&callback=initializeMap" async defer></script>

<script>
"use strict";

var form = document.getElementById("busStopForm");
form.addEventListener("submit", function(event) {
	event.preventDefault();
	var numberedBusStopo70101 = db1.getByKey("o70101");
	if(numberedBusStopo70101 === undefined || numberedBusStopo70101 === null) {
		loadNumberedBusStopData();
	}
	
	var numberedBusStop = db1.getByKey("o" + form.elements.stopNumber.value);
	if(numberedBusStop === undefined || numberedBusStop === null) {
		// show a validation error
		alert("stop number not found.");
		return;
	}
	
	if(isDebugging) {
		console.log("Saving stopNumber.value" + form.elements.stopNumber.value);
	}

	var newValue = '{"stopNumber":' + form.elements.stopNumber.value + ', "description":"' + form.elements.stopDescription.value + '"}';
	db1.setByKey("BusStopNumberEntered", newValue);
	showStop2(newValue);
  });

 if(db1.getByKey("o70101") == null && db1.supports_html5_storage){
	var sNew = document.createElement('script');
	sNew.async = false; // true;
	sNew.src = "stopOffsets.js";
	var s0 = document.getElementsByTagName('script')[0];
	s0.parentNode.insertBefore(sNew, s0);
}
if(tblStop.getByKey('WIHA') == null && db1.supports_html5_storage) {
	var sNew = document.createElement('script');
	sNew.async = false; // true;
	sNew.src = "stopLocations.js";
	var s0 = document.getElementsByTagName('script')[0];
	s0.parentNode.insertBefore(sNew, s0);
}

// global variables for location
var Marquette400S    = {latitude:44.979001, longitude:-93.268623};   //133 

var SouthAndWestOfGatewayRamp  = {latitude:44.9779802, longitude:-93.2642134};   //133  waypoint before Marquette and 4th
var Washington300S     = {latitude:44.979682,  longitude:-93.264170};            // 133 bus is on the move
var SWofWashington300S = {latitude:44.979299,  longitude:-93.263962};
var GrantAnd35W        = {latitude:44.969878,  longitude:-93.269835};            //133  returning, still on 35W

var FourthStreet215S = {latitude:44.978416,  longitude:-93.266661};   // #7
var SixthStreet201S  = {latitude:44.9763315, longitude:-93.268188};   // #14
var Washington300N   = {latitude:44.984393,  longtiude:-93.272505};   // #14
var Washington500N   = {latitude:44.978711,  longitude:-93.262360};   // #14

var BroadwayEmerson  = {latitude:44.999164,  longitude:-93.294136};   // #14
var PlymouthWashington = {latitude:44.992010,longitude:-93.281476};   // #14
var FifthStBusRamp   = {latitude:44.980832,  longitude:-93.275425};   // #14
var SixthNicollet    = {latitude:44.977802,  longitude:-93.271305};

var myRoute = -1; // 14;
var myDirection = -1; // 1;
var myStop = '';

var myBlockNumber = 0;
var myBlockNumberTimeout = new Date(2018,1,1);

var isCurrentTargetANumberedBusStop = false;    //  numbered vs scheduled bus stop

if(Modernizr.localstorage) {
	resetRecentChoiceButtons();
}

</script>


</body>
</html> 
